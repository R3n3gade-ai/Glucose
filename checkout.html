<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>GlucoBoost</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="assets/brand/favicon.png" rel="icon" type="image/png">

  <link href="assets/css/app.css" rel="stylesheet">
  <link href="assets/css/checkout.css" type="text/css" rel="stylesheet">

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link
    href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&amp;family=Oswald:wght@400;500;600;700&amp;family=Roboto+Condensed:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap"
    rel="stylesheet">
  <style>
    .chkbox {
      width: auto !important;
      height: auto !important;
      appearance: checkbox !important;
      outline: auto !important;
      display: inline !important;
      text-align: center !important;
    }

    label.payment_as_shipping_label {
      text-align: center;
      display: inline;
      font-size: 16px !important;
    }

    /* Ensure active product has checkmark style */
    .product.active .package-item__status span {
      background: url('assets/images/icon-validation-good.png') no-repeat center center;
      background-size: contain;
    }
  </style>
  <script src="/api/config.js"></script>
  <!-- Use standard Accept.js (not UI) for embedded fields -->
  <script type="text/javascript" src="https://js.authorize.net/v1/Accept.js" charset="utf-8"></script>
</head>

<body class="checkout">
  <div class="wrapper">
    <div id="app">
      <header class="order__header">
        <div class="order__header_top">
          <div class="container">
            <span class="views-coll">12 others </span> are viewing this offer right now <span class="timer"
              id="time">09:41</span>
          </div>
        </div>
        <div class="container">
          <div class="row order__header_in">
            <img alt="" src="assets/brand/logo2-strips.png" width="165">
            <div class="delivery-block">
              Internet Exclusive Offers
              Available to USA Residents Only
            </div>
          </div>
        </div>
      </header>

      <div class="order">
        <div class="container">
          <div class="row">
            <div class="order__left">
              <div class="steps">
                <ul class="steps__list row">
                  <li class="steps__item">1. Shipping Info</li>
                  <li class="steps__item active">2. Finish Order</li>
                  <li class="steps__item">3. Summary</li>
                </ul>
                <div class="approved-text">
                  <strong><span class="emphasis">APPROVED!</span> Free Bottle Packages Confirmed</strong>
                </div>
                <p>Limited supply available as of <span class="full-date date-container2">Wednesday, 1/7/2026</span>. We
                  currently have product <strong>in stock</strong> and ready to ship within 24 hours.</p>
                <p class="status-pr">Sell Out Risk: <span>HIGH</span></p>
              </div>

              <!-- Product selection with default active -->
              <div class="product-selection">
                <div class="product product1 sel-prod active" data-pkg="5" data-price="199.99">
                  <div class="package-item">
                    <div class="package-item__header ">
                      <div class="title-block">
                        <span class="title-block__main">BUY 3 GET 3 FREE*</span>
                        <span class="title-block__retail">Retail: <br><span
                            class="retail-price">$66.64</span>/bottle</span>
                      </div>
                      <div class="shipping-row">
                        <span>FREE SHIPPING</span>
                      </div>
                    </div>

                    <div class="package-item__content">
                      <div class="package-item__status">
                        <span></span>
                      </div>
                      <div class="package-images">
                        <div class="package-images__item">
                          <img alt="" src="assets/brand/product.png" class="prod-btl1">
                          <img alt="" src="assets/brand/product.png" class="prod-btl2">
                          <img alt="" src="assets/brand/product.png" class="prod-btl3">
                        </div>
                        <img alt="" src="assets/images/plus-icon.png" class="chk-plus">
                        <div class="package-images__item">
                          <img alt="" src="assets/brand/product.png" class="prod-btl1">
                          <img alt="" src="assets/brand/product.png" class="prod-btl2">
                          <img alt="" src="assets/brand/product.png" class="prod-btl3">
                        </div>

                        <div class="package__save">
                          <span class="package__save_title">SAVE</span>
                          <span class="package__save_item save-price">$132.45</span>
                        </div>
                      </div>
                      <div class="package-info">
                        <span class="package-info__title">For Those Who Need <br> to Lose 25+ Pounds!</span>
                        <span class="package-info__subTitle">same as</span>
                        <span class="package-info__price">
                          <p style="display: inline-block" class="price">$39.99</p> <span>/bottle</span>
                        </span>
                        <p
                          style="font-size: 15px;font-weight:normal;font-family: 'Open Sans', sans-serif;padding:10px;">
                          <span class="package-info__total">
                            Total Price - <span class="full-price">$239.99</span></span>
                        </p>
                        <span class="package-info__btn">Selected!</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="product product2 sel-prod" data-pkg="3" data-price="159.99">
                  <div class="package-item">
                    <div class="package-item__header ">
                      <div class="title-block">
                        <span class="title-block__main">BUY 2 GET 2 FREE*</span>
                        <span class="title-block__retail">Retail: <br><span
                            class="retail-price">$74.95</span>/bottle</span>
                      </div>
                      <div class="shipping-row">
                        <span>FREE SHIPPING</span>
                      </div>
                    </div>

                    <div class="package-item__content">
                      <div class="package-item__status">
                        <span></span>
                      </div>
                      <div class="package-images">
                        <div class="package-images__item">
                          <img alt="" src="assets/brand/product.png" class="prod-btl1">
                          <img alt="" src="assets/brand/product.png" class="prod-btl3">
                        </div>
                        <img alt="" src="assets/images/plus-icon.png" class="chk-plus" style="left:145px;">
                        <div class="package-images__item">
                          <img alt="" src="assets/brand/product.png" class="prod-btl4">
                          <img alt="" src="assets/brand/product.png" class="prod-btl5">
                        </div>
                        <div class="package__save">
                          <span class="package__save_title">SAVE</span>
                          <span class="package__save_item save-price">$74.95</span>
                        </div>
                      </div>
                      <div class="package-info">
                        <span class="package-info__title">For Those Who Need <br> to Lose 15+ Pounds!</span>
                        <span class="package-info__subTitle">same as</span>
                        <span class="package-info__price">
                          <p style="display: inline-block" class="price">$47.49</p> <span>/bottle</span>
                        </span>
                        <p
                          style="font-size: 15px;font-weight:normal;font-family: 'Open Sans', sans-serif;padding:10px;">
                          <span class="package-info__total">
                            Total Price - <span class="full-price">$189.99</span></span>
                        </p>
                        <span class="package-info__btn">Select Package</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="product product3 sel-prod" data-pkg="1" data-price="69.99">
                  <div class="package-item">
                    <div class="package-item__header ">
                      <div class="title-block">
                        <span class="title-block__main">BUY 1 GET 1 FREE*</span>
                        <span class="title-block__retail">Retail: <br><span
                            class="retail-price">$79.99</span>/bottle</span>
                      </div>
                      <div class="shipping-row">
                        <span>FREE SHIPPING</span>
                      </div>
                    </div>

                    <div class="package-item__content">
                      <div class="package-item__status">
                        <span></span>
                      </div>
                      <div class="package-images">
                        <div class="package-images__item">
                          <img alt="" src="assets/brand/product.png" class="prod-btl1">
                        </div>
                        <img alt="" src="assets/images/plus-icon.png" class="chk-plus" style="left:132px;">
                        <div class="package-images__item">
                          <img alt="" src="assets/brand/product.png" class="prod-btl5" style="left:-18px;">
                        </div>
                      </div>
                      <div class="package-info">
                        <span class="package-info__title">For Those Who Need <br> to Lose 7+ Pounds!</span>
                        <span class="package-info__subTitle">&nbsp;</span>
                        <span class="package-info__price">
                          <p style="display: inline-block" class="price">$64.99</p> <span>/bottle</span>
                        </span>
                        <p
                          style="font-size: 15px;font-weight:normal;font-family: 'Open Sans', sans-serif;padding:10px;">
                          <span class="package-info__total">
                            Total Price - <span class="full-price">$129.99</span></span>
                        </p>
                        <span class="package-info__btn">Select Package</span>
                      </div>
                    </div>
                  </div>
                  <span class="footnote">* at retail price</span>
                </div>

                <img class="img-responsive secure-icons" src="assets/images/or-secureicons.jpg">
                <div class="guarantee-block">
                  <div class="guarantee-top">
                    30 day money back guarantee
                  </div>
                  <div class="guarantee-content">
                    <img alt="" class="guarantee-icon" src="assets/images/guarantee-ico.jpg">
                    <div class="guarantee-text">
                      <p>We are so confident in our products and services, that we back it with a 30
                        day money back guarantee. If for any reason you are not fully satisfied with
                        our products, simply return the purchased products in the original container
                        within 30 days of when you received your order. We will refund you 100% of
                        the purchase price - with absolutely no hassle<a href="admin.html"
                          style="text-decoration:none; color:inherit; cursor:default;">.</a></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="order__right">
              <div class="form__header">
                <h2>FINAL STEP:</h2>
                <h3>PAYMENT INFORMATION</h3>
              </div>
              <div class="form__in">
                <span class="accept-text">We Accept:</span>
                <ul class="form__cards">
                  <li><img alt="" src="assets/images/visa.png"></li>
                  <li><img alt="" src="assets/images/mastercard.png"></li>
                </ul>
                <form class="form-popup" id="checkout-form">
                  <input type="hidden" name="cpid" value="5" id="package">
                  <input type="hidden" name="device" value="desktop">
                  <input type="hidden" name="billingSameAsShipping" id="billShipSame" value="yes">

                  <!-- Hidden Shipping Fields populated from URL -->
                  <input type="hidden" id="shippingFirstName" name="firstName">
                  <input type="hidden" id="shippingLastName" name="lastName">
                  <input type="hidden" id="shippingAddress1" name="address">
                  <input type="hidden" id="shippingAddress2" name="address2">
                  <input type="hidden" id="shippingCity" name="city">
                  <input type="hidden" id="shippingState" name="state">
                  <input type="hidden" id="shippingZip" name="zip">
                  <input type="hidden" id="shippingPhone" name="phone">
                  <input type="hidden" id="shippingEmail" name="email">

                  <label for="payment_as_shipping" class="payment_as_shipping_label">
                    <input type="checkbox" name="" id="payment_as_shipping" checked="" class="chkbox bill-inp">
                    <span>Billing same as Shipping</span>
                  </label>

                  <div class="billing-info" style="display:none;">
                    <div class="billing-form">
                      <span class="billing-title">Billing Info</span>
                      <!-- Billing fields ... -->
                      <div class="form-holder">
                        <span>First Name: </span>
                        <input type="text" name="billingFirstName" id="firstName" placeholder="First Name"
                          class="form-control required">
                      </div>
                      <div class="form-holder">
                        <span>Last Name: </span>
                        <input type="text" name="billingLastName" id="lastName" placeholder="Last Name"
                          class="form-control required">
                      </div>
                      <!-- Add more billing fields as needed, shortened for brevity -->
                    </div>
                  </div>

                  <div class="margin-bottom-5" style="margin-top:20px;">
                    <div class="phone-12 columns">
                      <label>Card Number:</label>
                    </div>
                  </div>
                  <div class="phone-12 columns form-holder">
                    <input type="tel" id="cardNumber" class="form-control required" placeholder="Card Number"
                      maxlength="20" autocomplete="off">
                  </div>

                  <div class="row margin-bottom-5">
                    <div class="phone-12 columns">
                      <label>Card Expiry Date:</label>
                    </div>
                  </div>
                  <div class="row">
                    <div class="phone-6 columns form-holder">
                      <select id="expMonth" class="required form-control">
                        <option value="">Month</option>
                        <option value="01">01 - January</option>
                        <option value="02">02 - February</option>
                        <option value="03">03 - March</option>
                        <option value="04">04 - April</option>
                        <option value="05">05 - May</option>
                        <option value="06">06 - June</option>
                        <option value="07">07 - July</option>
                        <option value="08">08 - August</option>
                        <option value="09">09 - September</option>
                        <option value="10">10 - October</option>
                        <option value="11">11 - November</option>
                        <option value="12">12 - December</option>
                      </select>
                    </div>
                    <div class="phone-6 columns form-holder">
                      <select id="expYear" class="required form-control">
                        <option value="">Year</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                        <option value="2031">2031</option>
                        <option value="2032">2032</option>
                      </select>
                    </div>
                  </div>

                  <div class="row margin-bottom-5">
                    <div class="phone-12 columns">
                      <label>CVV:</label>
                    </div>
                  </div>
                  <div class="row">
                    <div class="phone-6 columns form-holder">
                      <input type="tel" id="cardCode" class="form-control required" maxlength="4" placeholder="CVV"
                        autocomplete="off">
                    </div>
                    <div class="phone-6 columns">
                      <span class="cvv-link "><a class="ccvwhatsthis form-link cvvbox" href="javascript:void(0)"
                          style="margin: 9px 0px 0px 2px;"> Where can I find my Security Code?</a></span>
                    </div>
                  </div>

                  <div class="form__footer" style="margin-top:20px;">
                    <div class="secure-icon"><span>Secure 256-bit SSL Encryption</span></div>
                    <button class="send-btn loading-btn" type="submit" id="submit-btn">
                      <span>RUSH MY ORDER!</span>
                    </button>
                  </div>

                  <div class="frmCheckElemts">
                    <label class="spl-checkbox" style="vertical-align:top;text-align: left;font-size: 14px !important;">
                      <input type="checkbox" name="emag_subscription" id="emag_subscription" value="Y" checked="checked"
                        class="chkbox" style="margin:0 !important;">
                      As a special gift you will gain access to the Health Digital Magazine Series today for the
                      discounted rate of only $19.93 monthly. For information on this separate enrollment, call any
                      time.</label>
                  </div>
                  <div class="msg" id="status"
                    style="display:none; margin-top:20px; padding:15px; border-radius:5px; text-align:center;"></div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer remains the same... -->
    </div>
  </div>

  <script type="text/javascript" src="assets/js/jquery-3.5.1.min.js"></script>
  <script type="text/javascript" src="assets/js/scripts.js"></script>

  <script>
    // Package selection logic
    var selectButtons = $('.package-info__btn');
    const products = {
      '5': { price: 239.99, qty: 5 },
      '3': { price: 189.99, qty: 3 },
      '1': { price: 129.99, qty: 1 }
    };
    let currentPkgId = '5'; // Default

    $(".product-selection > .product").click(function () {
      $('.active').removeClass("active");
      $(this).addClass("active");
      currentPkgId = $(this).data('pkg');
      $("input[id=package]").val(currentPkgId);

      var parentElement = this;
      selectButtons.each(function (i) {
        if ($.contains(parentElement, this)) {
          $(this).text("Selected!");
        } else {
          $(this).text("Select Package");
        }
      });
    });

    $('#payment_as_shipping').click(function () {
      if (this.checked) {
        $('.billing-info').hide();
        $('#billShipSame').val("yes");
      } else {
        $('.billing-info').show();
        $('#billShipSame').val("no");
      }
    });

    // Parse URL parameters and populate fields
    function getUrlParameter(name) {
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      var results = regex.exec(location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    $(document).ready(function () {
      const fields = ['firstName', 'lastName', 'shippingAddress1', 'shippingAddress2', 'shippingCity', 'shippingState', 'shippingZip', 'phone', 'email'];

      console.log('=== Checkout Page URL Parameters ===');
      console.log('Full URL:', window.location.href);

      fields.forEach(field => {
        const val = getUrlParameter(field);
        console.log(`${field}:`, val || '(empty)');
        if (val) {
          // Map to hidden shipping fields
          if (field === 'firstName') $('#shippingFirstName').val(val);
          if (field === 'lastName') $('#shippingLastName').val(val);
          if (field === 'shippingAddress1') $('#shippingAddress1').val(val);
          if (field === 'shippingAddress2') $('#shippingAddress2').val(val);
          if (field === 'shippingCity') $('#shippingCity').val(val);
          if (field === 'shippingState') $('#shippingState').val(val);
          if (field === 'shippingZip') $('#shippingZip').val(val);
          if (field === 'phone') $('#shippingPhone').val(val);
          if (field === 'email') $('#shippingEmail').val(val);

          // Also pre-fill billing fields in case they switch
          if (field === 'firstName') $('#firstName').val(val);
          if (field === 'lastName') $('#lastName').val(val);
        }
      });
      console.log('=== End URL Parameters ===');
    });

    // Authorize.Net Handling
    const form = document.getElementById('checkout-form');
    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const statusEl = document.getElementById('status');
      statusEl.style.display = 'block';
      statusEl.className = 'msg processing';
      statusEl.style.color = 'blue';
      statusEl.textContent = 'Processing secure payment...';

      const secureData = {
        authData: {
          clientKey: window.AUTHNET_PUBLIC_CLIENT_KEY,
          apiLoginID: window.AUTHNET_API_LOGIN_ID
        },
        cardData: {
          cardNumber: document.getElementById('cardNumber').value,
          month: document.getElementById('expMonth').value,
          year: document.getElementById('expYear').value,
          cardCode: document.getElementById('cardCode').value
        }
      };

      Accept.dispatchData(secureData, responseHandler);

      function responseHandler(response) {
        if (response.messages.resultCode === "Error") {
          statusEl.style.color = 'red';
          let errors = '';
          for (let i = 0; i < response.messages.message.length; i++) {
            errors += response.messages.message[i].text + '\n';
          }
          statusEl.textContent = '❌ Error: ' + errors;
          return;
        }

        processPayment(response.opaqueData);
      }
    });

    async function processPayment(opaqueData) {
      const pkgData = products[currentPkgId] || { price: 239.99 };
      const statusEl = document.getElementById('status');

      // Capture customer data for upsell page
      const customerData = {
        firstName: document.getElementById('shippingFirstName').value || document.getElementById('firstName').value,
        lastName: document.getElementById('shippingLastName').value || document.getElementById('lastName').value,
        email: document.getElementById('shippingEmail').value,
        phone: document.getElementById('shippingPhone').value,
        address: document.getElementById('shippingAddress1').value,
        city: document.getElementById('shippingCity').value,
        state: document.getElementById('shippingState').value,
        zip: document.getElementById('shippingZip').value
      };

      console.log('=== Customer Data for Payment ===');
      console.log('Customer Data:', customerData);
      console.log('=== End Customer Data ===');

      sessionStorage.setItem('customer', JSON.stringify(customerData));

      // Validate we have required customer info
      if (!customerData.firstName || !customerData.lastName || !customerData.email) {
        statusEl.style.color = 'red';
        statusEl.textContent = '❌ Error: Missing customer information. Please ensure you came from the order form.';
        return;
      }

      try {
        const payload = {
          amount: pkgData.price,
          firstName: customerData.firstName,
          lastName: customerData.lastName,
          email: customerData.email,
          address: customerData.address,
          city: customerData.city,
          state: customerData.state,
          zip: customerData.zip,
          phone: customerData.phone,
          opaqueData
        };

        const res = await fetch('/api/charge', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await res.json();

        if (res.ok) {
          statusEl.style.color = 'green';
          statusEl.textContent = '✅ Payment Approved! Redirecting to special offer...';
          setTimeout(() => {
            window.location.href = 'upsell-1.html';
          }, 1500);
        } else {
          statusEl.style.color = 'red';
          statusEl.textContent = '❌ Payment Declined: ' + (data.error || 'Unknown error');
        }
      } catch (err) {
        statusEl.style.color = 'red';
        statusEl.textContent = '❌ Server Error: ' + err.message;
      }
    }

    // Lead Capture Logic
    function captureLead() {
      const firstName = document.getElementById('shippingFirstName').value || document.getElementById('firstName').value;
      const lastName = document.getElementById('shippingLastName').value || document.getElementById('lastName').value;
      const email = document.getElementById('shippingEmail').value;
      const phone = document.getElementById('shippingPhone').value;

      if (email || phone) {
        fetch('/api/lead', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ firstName, lastName, email, phone })
        }).catch(e => console.log('Lead capture error', e));
      }
    }

    // Attach listeners to capture lead on blur
    ['shippingFirstName', 'shippingLastName', 'shippingEmail', 'shippingPhone', 'firstName', 'lastName'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('blur', captureLead);
      }
    });
  </script>
</body>

</html>